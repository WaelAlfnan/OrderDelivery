---
alwaysApply: true
---

  # .NET Development Rules

  You are a senior .NET backend developer and an expert in C#, ASP.NET Core, and Entity Framework Core.


#### **ğŸ“‚ Project Architecture**  
```
src/  
â”œâ”€â”€ OrderDeliveryApi/               # API Layer (Presentation)
â”‚   â”œâ”€â”€ Controllers/                # API Controllers  
â”‚   â”œâ”€â”€ Middleware/                 # Custom Middleware  
â”‚   â”œâ”€â”€ appsettings.json            # Configurations  
â”‚   â””â”€â”€ Program.cs                  # Startup & DI  
â”‚  
â”œâ”€â”€ OrderDelivery.Application/      # Business Logic Layer  
â”‚   â”œâ”€â”€ DTOs/                       # Request/Response Models  
â”‚   â”œâ”€â”€ Interfaces/                 # Service Contracts  
â”‚   â”œâ”€â”€ Mappers/                    # Manual DTO Mappings  
â”‚   â”œâ”€â”€ Services/                   # Business Logic  
â”‚   â””â”€â”€ Validators/                 # FluentValidation Rules  
â”‚  
â”œâ”€â”€ OrderDelivery.Domain/           # Core Domain Layer  
â”‚   â”œâ”€â”€ Entities/                   # Domain Models  
â”‚   â”œâ”€â”€ Enums/                      # Enumerations  
â”‚   â”œâ”€â”€ Interfaces/                 # Repository Contracts  
â”‚   â””â”€â”€ UnitOfWork.cs               # Unit of Work Pattern  
â”‚  
â””â”€â”€ OrderDelivery.Infrastructure/   # Data & External Services  
    â”œâ”€â”€ Configurations/             # EF Core Configs  
    â”œâ”€â”€ Data/                       # Database Context  
    â”œâ”€â”€ Repositories/               # Data Access Layer
    â”œâ”€â”€ Extensions/                 # Helper Extensions 
    â””â”€â”€ Migrations/  

tests/  
â”œâ”€â”€ UnitTests/                      # Unit Tests  
â”‚   â”œâ”€â”€ Application/                # Service & Validator Tests  
â”‚   â”œâ”€â”€ Mappers/                    # Mapping Tests  
â”‚   â””â”€â”€ Infrastructure/             # Repository Tests  
â”‚  
â””â”€â”€ IntegrationTests/               # Integration Tests  
    â”œâ”€â”€ Api/                        # Controller Tests  
    â””â”€â”€ Db/                         # Database Integration Tests  
```  

---

### **ğŸ“œ Development Rules (Commands Only)**  

#### **1. Architecture & Layers**  
âœ… **API Layer (OrderDeliveryApi)**  
- Only handle HTTP requests/responses.  
- No business logic inside controllers.  
- Use dependency injection for services.  

âœ… **Application Layer (OrderDelivery.Application)**  
- Contains all business logic.  
- Services must implement interfaces.  
- Manual DTO mapping only (no AutoMapper for DTOs).  

âœ… **Domain Layer (OrderDelivery.Domain)**  
- Pure domain models and contracts.  
- No external dependencies.  

âœ… **Infrastructure Layer (OrderDelivery.Infrastructure)**  
- Database and external service integrations.  
- Repository pattern for data access.  

---

#### **2. DTOs & Mappings**  
âœ… **DTO Rules**  
- Must be records (immutable).  
- Separate folders for `Requests` and `Responses`.  
- No domain entities exposed in APIs.  

âœ… **Manual Mapping Rules**  
- One mapper per DTO transformation.  
- Mappers must be static methods.  
- Explicit null checks required.  

âœ… **Testing Mappings**  
- 100% test coverage for mappers.  
- Test edge cases (null, empty collections).  

---

#### **3. Business Logic (Services)**  
âœ… **Service Contracts**  
- Every service must have an interface.  
- Use dependency injection (constructor-based).  

âœ… **Service Implementation**  
- No direct database access (use repositories).  
- No DTO mapping inside services.  

âœ… **Testing Services**  
- Mock dependencies in unit tests.  
- Test all business scenarios.  

---

#### **4. Data Access (Repositories & EF Core)**  
âœ… **Repository Pattern**  
- One repository per aggregate root.  
- Use `UnitOfWork` for transactions.  

âœ… **Entity Framework Rules**  
- Configurations in separate folder.  
- No raw SQL in controllers.  

âœ… **Testing Repositories**  
- Unit test repository logic.  
- Integration tests for DB operations.  

---

#### **5. API & Controllers**  
âœ… **Controller Rules**  
- Thin controllers (delegate to services).  
- Use `ActionResult<T>` for responses.  
- Proper HTTP status codes.  

âœ… **Validation**  
- FluentValidation for all requests.  
- Global exception handling.  

âœ… **Testing Controllers**  
- Integration tests for all endpoints.  
- Test authentication/authorization.  

---

#### **6. Testing Strategy**  
âœ… **Unit Tests**  
- Test services, validators, mappers.  
- Mock external dependencies.  

âœ… **Integration Tests**  
- Test API endpoints.  
- Test database operations.  

âœ… **Test Naming Convention**  
- `MethodName_Scenario_ExpectedResult`  

---

#### **7. Security & Best Practices**  
âœ… **Security Rules**  
- Validate all inputs.  
- Use JWT for authentication.  
- Never expose sensitive data in DTOs.  

âœ… **Performance Rules**  
- Async/await for I/O operations.  
- Avoid N+1 queries in EF Core.  

âœ… **Code Quality**  
- SOLID principles.  
- Clean code practices.  
- Meaningful naming conventions.  

---

### **âœ… Checklist for New Features**  
1. **Design DTOs** (Request/Response).  
2. **Create Mappers** (manual, with tests).  
3. **Define Service Interfaces**.  
4. **Implement Business Logic** (services).  
5. **Add Validation Rules**.  
6. **Implement API Endpoint**.  
7. **Write Unit & Integration Tests**.  
8. **Update Documentation**.  

---

### **ğŸš« Anti-Patterns to Avoid**  
âŒ Business logic in controllers.  
âŒ AutoMapper for DTOs.  
âŒ Raw SQL in APIs.  
âŒ Untested mappers.  
âŒ Exposing domain entities directly.  

---

### **ğŸ”„ Workflow**  
1. **Design** (DTOs, Contracts).  
2. **Implement** (Mappers â†’ Services â†’ API).  
3. **Test** (Unit â†’ Integration).  
4. **Review** (Code Quality, Security).  
5. **Deploy**.  

This ensures:  
âœ” **Clean separation of concerns**  
âœ” **Testable and maintainable code**  
âœ” **High performance & security**  
âœ” **Consistency across the project**